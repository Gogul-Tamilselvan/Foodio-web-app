<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile | Foodio</title>
  <link rel="icon" type="image/x-icon" href="../images/webicon.png">
  <!-- bootstrap cdn -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
  <!-- Fast Bootstrap cdn -->
  <link href="https://cdn.jsdelivr.net/npm/fastbootstrap@2.2.0/dist/css/fastbootstrap.min.css" rel="stylesheet"
    integrity="sha256-V6lu+OdYNKTKTsVFBuQsyIlDiRWiOmtC8VQ8Lzdm2i4=" crossorigin="anonymous" />

  <!-- font awesome cdn -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- aos cdn -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

  <link rel="stylesheet" href="../Css/signup.css" />
  <link rel="stylesheet" href="../Css/main.css">
  <link rel="stylesheet" href="../Css/loader.css">
</head>

<body>

  <!-- preloader starts -->
  <div  id="headerloader" class="headerloader" >
    <div class="loader"></div>
  </div>

  <!-- nav bar start -->


  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarButtonsExample"
        aria-expanded="false">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand mt-2" href="#">
        <img src="../images/foodio.png" alt="" width="140" height="50"
      </a>
      <div class="collapse navbar-collapse" id="navbarButtonsExample">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="../index.html#home">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="./cart.html">View cart <span
                class="badge text-bg-danger">9+</span></a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" aria-current="page" href="#">View orders</a>
          </li> -->
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="./Profile.html">View your profile</a>
          </li>
        </ul>
        <div class="d-flex align-items-center ms-auto mb-2 mt-2">
          <button type="button" id="logout" class="btn px-3 me-2 loginbtn">
            <i class="fa-solid fa-user"></i> Logout
          </button>
          <a class="btn btn-subtle px-3 github" href="https://github.com/mdbootstrap/mdb-ui-kit" role="button"><i
              class="fa-brands fa-github"></i></a>
        </div>
      </div>
    </div>
  </nav>
  <!-- nav bar end -->
<section style="background-color: #eee;">
    <div class="container py-5">

  
      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <img src="https://picsum.photos/200" alt="avatar"
                class="rounded-circle img-fluid" style="width: 150px;">
              <h5 id="name" class="my-3"></h5>
            </div>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-sm-3">
                  <p  class="mb-0">Full Name</p>
                </div>
                <div class="col-sm-9">
                  <p id="name1" class="text-muted mb-0"></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Email</p>
                </div>
                <div class="col-sm-9">
                  <p id="email" class="text-muted mb-0"></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p  class="mb-0">Phone</p>
                </div>
                <div class="col-sm-9">
                  <p id="phone" class="text-muted mb-0"></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Address</p>
                </div>
                <div class="col-sm-9">
                  <p id="street" class="text-muted mb-0"></p>
                  <p id="city" class="text-muted mb-0"></p>
                  <p id="landmark" class="text-muted mb-0"></p>
                  <p id="state" class="text-muted mb-0"></p>
                  <p id="country" class="text-muted mb-0"></p>
                  <p id="zipcode" class="text-muted mb-0"></p>
                 
                </div>
              </div>
            </div>
          </div>

            <div class="row">
            <div class="col-md-12">
              <div class="card mb-4 mb-md-0">
                <div class="card-body">
                  <p class="mb-4">Your Order History</p>
                  <table id="table" class="table table-striped  table-hover">
                    <!-- <tbody id="tbody">
                      <tr>
                        <th scope="row">
                          <div class="d-flex align-items-center">
                            <img
                              src="https://picsum.photos/200"
                              class="img-fluid rounded-3"
                              style="width: 70px"
                              alt="Food"
                            />
                            <div class="flex-column ms-4">
                              <p class="mb-2">Food Name</p>
                            </div>
                          </div>
                        </th>
                      </tr>
                     
                    </tbody> -->
                  </table>
                </div>
              </div>
            </div>
            
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
  </script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   <script type="module">
        window.addEventListener('load',()=>{document.getElementById('headerloader').style.display='none';})
      // firebase authentication
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getDatabase,
        off,
        set,
        ref,
        get,
        child,remove,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
      import {
        getAuth,
        signInWithEmailAndPassword,signOut
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
      import { default as firebaseConfig } from "../Js/firebase.js";

      const app = initializeApp(firebaseConfig);
      const db = getDatabase();
      const auth = getAuth(app);
      const dbref = ref(db);

    //   let arr = [];
      async function profilefetch() {
        try {
          const session = sessionStorage.getItem("user-creds");
          const res = JSON.parse(session);
          const uid = res.uid;
          const orderDetailsRef = ref(db,"UsersRegisterList/" + uid + "/address/");         
          get(orderDetailsRef)
            .then((snapshot) => {
              if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                  const Name = childSnapshot.val().Name;
                  document.getElementById('name').innerHTML=Name;
                  document.getElementById('name1').innerHTML=Name;
                  const Phone = childSnapshot.val().Phone;
                  document.getElementById('phone').innerHTML=Phone;
                  const Email = childSnapshot.val().Email;
                  document.getElementById('email').innerHTML=Email;
                  const Street = childSnapshot.val().Street;
                  document.getElementById('street').innerHTML=Street;
                  const City = childSnapshot.val().City;
                  document.getElementById('city').innerHTML=City;
                  const Landmark = childSnapshot.val().Landmark;
                  document.getElementById('landmark').innerHTML=Landmark;
                  const State = childSnapshot.val().State;
                  document.getElementById('state').innerHTML=State;
                  const Country = childSnapshot.val().Country;
                  document.getElementById('country').innerHTML=Country;
                 ;
                })}})
        } catch(err){
            console.log(err.message);
          } } 
        profilefetch()

        const arr0 = new Set();
        async function deliverieditems() {
        try {
          const session = sessionStorage.getItem("user-creds");
          const res = JSON.parse(session);
          const uid = res.uid;
          const orderDetailsRef = ref(db,"UsersRegisterList/" + uid + "/deliveried/");         
          get(orderDetailsRef)
            .then((snapshot) => {
              if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                  const foodid =  childSnapshot.val().foodid;
                  arr0.add(foodid);
                  })}})
                  .then(()=>{
                    arr0.forEach(async (res)=>{
                    const fetchingg = await fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${res}`);
                    const response = await fetchingg.json();
                    const mealname = response.meals[0].strMeal;
                    const image = response.meals[0].strMealThumb;
                    const data =`                    <tbody id="tbody">
                      <tr>
                        <th scope="row">
                          <div class="d-flex align-items-center">
                            <img
                              src="${image}"
                              class="img-fluid rounded-3"
                              style="width: 70px"
                              alt="Food"
                            />
                            <div class="flex-column ms-4">
                              <p class="mb-2">${mealname}</p>
                            </div>
                          </div>
                        </th>
                      </tr>
                    </tbody>`;
                    document.getElementById('table').innerHTML+=data;
                  })})}      
        catch(err){
            console.log(err.message);
          } } 
        deliverieditems()


        let checkcred = () => {
      if (!sessionStorage.getItem("user-creds")) {
        window.location.href = "./signin.html";
      }
    }
    window.addEventListener('load', checkcred)
    // logout function
    const logout =document.getElementById('logout')
    logout.addEventListener('click', () => {
      sessionStorage.clear();
      signOut(auth)
        .then(async () => {
          let timerInterval;
          await Swal.fire({
            title: "Logging Out...",
            html: "Going to close in <b></b> milliseconds.",
            timer: 2000,
            timerProgressBar: true,
            didOpen: () => {
              Swal.showLoading();
              const timer = Swal.getPopup().querySelector("b");
              timerInterval = setInterval(() => {
                timer.textContent = `${Swal.getTimerLeft()}`;
              }, 100);
            },
            willClose: () => {
              clearInterval(timerInterval);
            }
          })
          window.location.href = "./signin.html";
        })
        .catch((error) => {
          // An error happened.
          console.error("Error signing out: ", error);
        });
    })

   </script>   
</body>
</html>